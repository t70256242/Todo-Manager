<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PrOrganize</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../static/assets/css/mam.css" />

   <!-- Favicons -->
  <link rel="icon" type="image/svg+xml" href="../static/assets/img/part_1/fav-2.png">

  {% block styles %}
  {% endblock %}

  <!-- Chart.js -->
    <script src="../static/assets/js/everything.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<body>

  <!-- Sidebar -->
  {% if global_data.user %}
  <div class="d-flex">
    <nav id="sidebar" class="sidebar expanded">
      <div class="logo-header d-flex justify-content-between align-items-center p-3 " data-background-color="dark">
        <a href="{{ url_for('dashboard') }}" aria-label="Go to Dashboard" class="logo d-flex align-items-center">

          <img

            src="../static/assets/img/part_1/logo_1_.png"
            alt="Logo"
            class="navbar-brand"
            height=40"
          />
        </a>

        <button class="btn btn-sm text-white p-2" id="menu-toggle">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-list" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M2 12.5a.5.5 0 0 1 0-1h12a.5.5 0 0 1 0 1H2zm0-5a.5.5 0 0 1 0-1h12a.5.5 0 0 1 0 1H2zm0-5a.5.5 0 0 1 0-1h12a.5.5 0 0 1 0 1H2z"/>
          </svg>
        </button>
      </div>

      <ul class="nav flex-column p-3">
          <!-- Dashboard item -->
          <li class="nav-item">
              <a href="{{ url_for('dashboard') }}" aria-label="Dashboard" class="nav-link d-flex align-items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-house me-2" viewBox="0 0 16 16">
                      <path fill-rule="evenodd" d="M8.354 1.146a.5.5 0 0 1 .292.144l6 6a.5.5 0 0 1-.707.708L8.5 2.207 2.207 7.998 1.5 7.5l6-6a.5.5 0 0 1 .707-.354zm-.354.354L2 7.5l6-6z"/>
                      <path fill-rule="evenodd" d="M7 13V7h2v6H7z"/>
                  </svg>
                  <span>Dashboard</span>
              </a>
          </li>

          <!-- Project item with dropdown -->
          <li class="nav-item dropdown">
              <a href="{{ url_for('project_list') }}" aria-label="Projects" class="nav-link dropdown-toggle d-flex align-items-center" id="projectDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-hdd-stack me-2" viewBox="0 0 16 16">
                    <path d="M14 10a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1zM2 9a2 2 0 0 0-2 2v1a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-1a2 2 0 0 0-2-2z"/>
                    <path d="M5 11.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0m-2 0a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0M14 3a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1zM2 2a2 2 0 0 0-2 2v1a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2z"/>
                    <path d="M5 4.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0m-2 0a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0"/>
                  </svg>
                  <span>Projects</span>
              </a>
              <ul class="dropdown-menu" aria-labelledby="projectDropdown">
                  {% for project in global_data.projects[:2] %}
                    <li><a class="dropdown-item" href="{{ url_for('project_select', number=project.id) }}">{{ project.title | title }}</a></li>
                  {% endfor %}
                  <li><a class="dropdown-item" href="{{ url_for('project_list') }}">All Projects</a></li>
              </ul>
          </li>

          <!-- To-do item -->
          <li class="nav-item">
              <a href="{{ url_for('todo_list') }}" aria-label="Todo" class="nav-link d-flex align-items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check2-square me-2" viewBox="0 0 16 16">
                    <path d="M3 14.5A1.5 1.5 0 0 1 1.5 13V3A1.5 1.5 0 0 1 3 1.5h8a.5.5 0 0 1 0 1H3a.5.5 0 0 0-.5.5v10a.5.5 0 0 0 .5.5h10a.5.5 0 0 0 .5-.5V8a.5.5 0 0 1 1 0v5a1.5 1.5 0 0 1-1.5 1.5z"/>
                    <path d="m8.354 10.354 7-7a.5.5 0 0 0-.708-.708L8 9.293 5.354 6.646a.5.5 0 1 0-.708.708l3 3a.5.5 0 0 0 .708 0"/>
                  </svg>
                  <span>Todo</span>
                  {% if global_data.todo_count > 0 %}
                  <span class="badge bg-secondary ms-3">{{ global_data.todo_count }}</span>
                  {% endif %}
              </a>
          </li>

          <!-- Birthday -->
          <li class="nav-item">
              <a href="{{ url_for('birthday_list') }}" aria-label="Birthday" class="nav-link d-flex align-items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cake2 me-2" viewBox="0 0 16 16">
                    <path d="m3.494.013-.595.79A.747.747 0 0 0 3 1.814v2.683q-.224.051-.432.107c-.702.187-1.305.418-1.745.696C.408 5.56 0 5.954 0 6.5v7c0 .546.408.94.823 1.201.44.278 1.043.51 1.745.696C3.978 15.773 5.898 16 8 16s4.022-.227 5.432-.603c.701-.187 1.305-.418 1.745-.696.415-.261.823-.655.823-1.201v-7c0-.546-.408-.94-.823-1.201-.44-.278-1.043-.51-1.745-.696A12 12 0 0 0 13 4.496v-2.69a.747.747 0 0 0 .092-1.004l-.598-.79-.595.792A.747.747 0 0 0 12 1.813V4.3a22 22 0 0 0-2-.23V1.806a.747.747 0 0 0 .092-1.004l-.598-.79-.595.792A.747.747 0 0 0 9 1.813v2.204a29 29 0 0 0-2 0V1.806A.747.747 0 0 0 7.092.802l-.598-.79-.595.792A.747.747 0 0 0 6 1.813V4.07c-.71.05-1.383.129-2 .23V1.806A.747.747 0 0 0 4.092.802zm-.668 5.556L3 5.524v.967q.468.111 1 .201V5.315a21 21 0 0 1 2-.242v1.855q.488.036 1 .054V5.018a28 28 0 0 1 2 0v1.964q.512-.018 1-.054V5.073c.72.054 1.393.137 2 .242v1.377q.532-.09 1-.201v-.967l.175.045c.655.175 1.15.374 1.469.575.344.217.356.35.356.356s-.012.139-.356.356c-.319.2-.814.4-1.47.575C11.87 7.78 10.041 8 8 8c-2.04 0-3.87-.221-5.174-.569-.656-.175-1.151-.374-1.47-.575C1.012 6.639 1 6.506 1 6.5s.012-.139.356-.356c.319-.2.814-.4 1.47-.575M15 7.806v1.027l-.68.907a.94.94 0 0 1-1.17.276 1.94 1.94 0 0 0-2.236.363l-.348.348a1 1 0 0 1-1.307.092l-.06-.044a2 2 0 0 0-2.399 0l-.06.044a1 1 0 0 1-1.306-.092l-.35-.35a1.935 1.935 0 0 0-2.233-.362.935.935 0 0 1-1.168-.277L1 8.82V7.806c.42.232.956.428 1.568.591C3.978 8.773 5.898 9 8 9s4.022-.227 5.432-.603c.612-.163 1.149-.36 1.568-.591m0 2.679V13.5c0 .006-.012.139-.356.355-.319.202-.814.401-1.47.576C11.87 14.78 10.041 15 8 15c-2.04 0-3.87-.221-5.174-.569-.656-.175-1.151-.374-1.47-.575-.344-.217-.356-.35-.356-.356v-3.02a1.935 1.935 0 0 0 2.298.43.935.935 0 0 1 1.08.175l.348.349a2 2 0 0 0 2.615.185l.059-.044a1 1 0 0 1 1.2 0l.06.044a2 2 0 0 0 2.613-.185l.348-.348a.94.94 0 0 1 1.082-.175c.781.39 1.718.208 2.297-.426"/>
                  </svg>
                  <span>Birthday</span>
                  {% if global_data.this_month_birthday > 0 %}
                  <span class="badge bg-primary ms-3">{{ global_data.this_month_birthday }}</span> <!-- Badge displaying the number of tasks -->
                  {% endif %}
              </a>
          </li>

      </ul>

      <!-- New section at the bottom -->
        <div class="settings-calendar p-3 mt-auto" >
            <ul class="nav flex-column">

                <li class="nav-item">
                    <a href="{{ url_for('calender_list') }}" aria-label="Calendar" class="nav-link d-flex align-items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-calendar3 me-2" viewBox="0 0 16 16">
                          <path d="M14 0H2a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2M1 3.857C1 3.384 1.448 3 2 3h12c.552 0 1 .384 1 .857v10.286c0 .473-.448.857-1 .857H2c-.552 0-1-.384-1-.857z"/>
                          <path d="M6.5 7a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2m-9 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2m-9 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2"/>
                        </svg>
                        <span class="text-muted">Calendar</span>
                    </a>
                </li>
            </ul>
        </div>

    </nav>


    <!-- Main Content Wrapper -->
    <div class="main-content w-100">

      <!-- Main Header -->
      <nav class="navbar navbar-expand-lg main-header">
        <div class="container-fluid">
          <!-- Left-aligned icon search bar -->
          <div class="me-2">
            <nav
                class="navbar navbar-header-right navbar-expand-lg navbar-form nav-search p-0 d-none d-lg-flex"
              >

                <form class="input-group" method="POST" action="">

                    <div class="ms-md-auto py-2 py-md-0">
                      <div class="input-group me-3">

                        <!-- Search Input -->
                        <input id="searchBarInput" type="text" class="form-control" placeholder="Search tasks, events..." aria-label="Search">

                        <!-- Dropdown Button aligned to the right -->
                        <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-label="Search Options" aria-expanded="false">
                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                            <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"/>
                          </svg>
                        </button>

                        <!-- Dropdown Menu -->
                        <ul class="dropdown-menu dropdown-menu-end" style="background: #0C0C0C; ">
                          <li><a class="search dropdown-item" href="#" data-topic="tasks" style="font-weight: bold; font-size: 15px;">Tasks</a></li>
                          <li><a class=" search dropdown-item" href="#" data-topic="projects" style="font-weight: bold; font-size: 15px;">Projects</a></li>
                          <li><a class="search dropdown-item" href="#" data-topic="birthdays" style="font-weight: bold; font-size: 15px;">Birthdays</a></li>
                        </ul>

                      </div>
                    </div>
                </form>

              </nav>
          </div>

          <!-- Empty middle column -->
          <div class="col-4 "></div>

          <!-- Right-aligned icons -->
          {% if global_data.user %}
          <div class="col-4 d-flex justify-content-end">
            <ul class="navbar-nav topbar-nav ms-md-auto align-items-center d-flex flex-row">
              <!-- Notification Icon -->
              <li class="nav-item topbar-icon dropdown hidden-caret">
                <a class="nav-link dropdown-toggle" aria-label="Notification bell icon" href="#" id="notifDropdown" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bell" viewBox="0 0 16 16">
                    <path d="M8 16a2 2 0 0 0 1.985-1.75H6.015A2 2 0 0 0 8 16zm.5-16A4.5 4.5 0 0 0 4 4c0 1.098-.269 1.979-.805 2.717-.376.522-.698.979-1.184 1.532C1.606 8.963 1.5 9.34 1.5 10v.5l-.535.673A1.5 1.5 0 0 0 1.5 13h13a1.5 1.5 0 0 0 1.035-2.327L15 10.5V10c0-.66-.106-1.037-.511-1.751a4.662 4.662 0 0 0-1.184-1.532C12.269 5.979 12 5.098 12 4A4.5 4.5 0 0 0 8.5 0zM14 10.5v.5h-12v-.5l.535-.673c.411-.515.782-.984 1.167-1.5C5.205 7.021 5.5 6.098 5.5 4A3.5 3.5 0 0 1 8.5 1 3.5 3.5 0 0 1 12 4c0 2.098.29 3.021 1.798 4.327.385.516.756.985 1.167 1.5L14 10.5z"/>
                  </svg>
                    {% if global_data.unread_notifications %}
                        <span class="badge bg-secondary position-absolute top-1 start-80 translate-middle p-1 pt-1 ">
                            {{ global_data.unread_notifications | length }}
                        </span>
                    {% endif %}
                </a>

                <!-- Notification Pop -->
                <ul class="dropdown-menu dropdown-menu-end notif-box animated fadeIn" aria-labelledby="notifDropdown">
                  <!-- Notification Header -->
                  {% if global_data.notifications %}
                  <li class="dropdown-header p-2 bg-dark text-muted fw-bold border-bottom">
                    You have {{ global_data.unread_notifications | length }} new notifications
                  </li>

                  <!-- Notifications List -->

                  <li>
                    <div class="notif-scroll scrollbar-outer">
                      <div class="notif-center list-group list-group-flush">
                        <a href="" onclick="return false;" class="list-group-item list-group-item-action d-flex align-items-center" style="background: #9B3922; cursor: default;">
                          <div class="notif-icon notif-primary rounded-circle d-flex justify-content-center align-items-center me-3" style="width: 35px; height: 35px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-plus" viewBox="0 0 16 16">
                              <path d="M8 7a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM2 11s-1 0-1 1 1 3 6 3 6-2 6-3-1-1-1-1H2zm11-5a.5.5 0 0 1 .5.5v2H15a.5.5 0 0 1 0 1h-1.5v2a.5.5 0 0 1-1 0v-2H11a.5.5 0 0 1 0-1h1.5v-2a.5.5 0 0 1 .5-.5z"/>
                            </svg>
                          </div>
                          {% if global_data.notifications[-1].read %}
                          <div class="notif-content">
                            <span class="">{{ global_data.notifications[-1].message | title }}</span>

                            <br>
                            <small class="text-muted">5 minutes ago</small>
                          </div>
                          {% else %}
                          <div class="notif-content">
                            <span class="fw-bold">{{ global_data.notifications[-1].message | title }}</span>

                            <br>
                            <small class="text-muted">5 minutes ago</small>
                          </div>
                            {% endif %}
                        </a>
                      </div>
                    </div>
                  </li>
                  {% else %}
                  <li class="dropdown-header p-2 bg-dark text-muted fw-bold border-bottom">
                    You have no new notification
                  </li>
                  {% endif %}

                  <!-- All Notification Link -->
                  <li class="border-top">
                    <a class="see-all d-block text-center text-decoration-none py-2 viewNotificationsBtn" href="javascript:void(0);">
                      See all notifications
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-right ms-1" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M6.646 4.646a.5.5 0 0 1 .708 0L10 7.293l-2.646 2.647a.5.5 0 0 1-.708-.708L8.293 8 6.646 6.354a.5.5 0 0 1 0-.708z"/>
                      </svg>
                    </a>
                  </li>
                </ul>


              </li>
              <!-- Notification Icon End -->

              <!-- Message Icon -->
              <li class="nav-item topbar-icon dropdown hidden-caret">
                <a class="nav-link dropdown-toggle" aria-label="Message envelope icon" href="#" id="messageDropdown" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-envelope-open" viewBox="0 0 16 16">
                    <path d="M8.47 1.318a1 1 0 0 0-.94 0l-6 3.2A1 1 0 0 0 1 5.4v.817l5.75 3.45L8 8.917l1.25.75L15 6.217V5.4a1 1 0 0 0-.53-.882zM15 7.383l-4.778 2.867L15 13.117zm-.035 6.88L8 10.082l-6.965 4.18A1 1 0 0 0 2 15h12a1 1 0 0 0 .965-.738ZM1 13.116l4.778-2.867L1 7.383v5.734ZM7.059.435a2 2 0 0 1 1.882 0l6 3.2A2 2 0 0 1 16 5.4V14a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V5.4a2 2 0 0 1 1.059-1.765z"/>
                  </svg>
                  {% if global_data.unread_message |length > 0 %}
                    <span class="badge bg-danger position-absolute top-1 start-80 translate-middle p-1 pt-1 ">

                        {{ global_data.unread_message |length }}
                    </span>
                  {% endif %}
                </a>

                <!-- Message Pop-->
                <ul class="dropdown-menu dropdown-menu-end notif-box animated fadeIn" aria-labelledby="notifDropdown">
                  <!-- Message Header -->
                  {% if global_data.unread_message |length > 0 %}
                  <li class="dropdown-header p-2 bg-dark text-muted fw-bold border-bottom">
                    You have {{ global_data.unread_message |length }} new messages
                  </li>

                  <!-- Messages List -->
                  <li>
                    <div class="notif-scroll scrollbar-outer">
                      <div class="notif-center list-group list-group-flush">
                        {% if global_data.user_received_messages %}
                        <a href="{{ url_for('message_select', message_id=global_data.user_received_messages[0].id) }}" class="list-group-item list-group-item-action d-flex align-items-center" style="background: #9B3922;" >
                          <div class="notif-icon notif-primary rounded-circle d-flex justify-content-center align-items-center me-3" style="width: 35px; height: 25px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-plus" viewBox="0 0 16 16">
                              <path d="M8 7a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM2 11s-1 0-1 1 1 3 6 3 6-2 6-3-1-1-1-1H2zm11-5a.5.5 0 0 1 .5.5v2H15a.5.5 0 0 1 0 1h-1.5v2a.5.5 0 0 1-1 0v-2H11a.5.5 0 0 1 0-1h1.5v-2a.5.5 0 0 1 .5-.5z"/>
                            </svg>
                          </div>
                          <div class="notif-content">

                            <span class="fw-bold" style="
                             white-space: nowrap;
                             overflow: hidden;
                             text-overflow: ellipsis;
                             display: block;
                             max-width: 100%;">
                                {{ global_data.user_received_messages[-1].message_content | title }}
                            </span>
                            <br>
                            <small class="text-muted">5 minutes ago</small>
                            <hr>
                          </div>
                        </a>
                        {% endif %}
                      </div>
                    </div>
                  </li>
                  {% else %}
                    <li class="dropdown-header p-2 bg-dark text-muted fw-bold border-bottom">
                    You have no new message
                  </li>
                  {% endif %}

                  <!-- All Messages Link -->
                  <li class="border-top">
                    <a class="see-all d-block text-center text-decoration-none py-2"  href="{{ url_for('messages') }}" >
                      See all messages
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-right ms-1" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M6.646 4.646a.5.5 0 0 1 .708 0L10 7.293l-2.646 2.647a.5.5 0 0 1-.708-.708L8.293 8 6.646 6.354a.5.5 0 0 1 0-.708z"/>
                      </svg>
                    </a>
                  </li>
                </ul>

              </li>
              <!-- Message Icon End -->

              <!-- User Icon -->
              <li class="nav-item topbar-user dropdown hidden-caret d-flex align-items-center">
                <a class="dropdown-toggle profile-pic d-flex align-items-center border rounded-pill p-2" aria-label="User icon" data-bs-toggle="dropdown" href="#" aria-expanded="false" style="border: 1px solid #F2613F !important;">
                  {% if global_data.user.profile_picture_path %}
                  <div class="avatar-sm me-2">
                    <img src="../{{ global_data.user.profile_picture_path }}" alt="..." class="avatar-img rounded-circle" style="width: 30px; height: 30px;" />
                  </div>
                  {% else %}
                  <span class="avatar-title rounded-circle border border-white bg-info text-white"
                      style="display: flex; align-items: center; justify-content: center; text-decoration: none !important; font-size: 0.9em; font-weight: bold; line-height: 1; width: 30px; height: 30px; overflow: hidden; text-align: center;">
                    {{ global_data.user.first_name[0].upper() }}{{ global_data.user.last_name[0].upper() }}
                  </span>
                  {% endif %}
                  <span class="profile-username d-flex align-items-center">

                    <span class="op-7 me-1">Hi,</span>
                    <span class="fw-bold">{{ global_data.user.first_name }}</span>
                  </span>
                </a>

                <!-- User Dropdown -->
                <ul class="dropdown-menu dropdown-menu-end dropdown-user animated fadeIn">

                  <!-- Divider and Links -->
                  <li class="dropdown-divider"></li>

                  <!-- Menu Items -->

                  <li><div class="open-modal-btn dropdown-item d-flex align-items-center py-2" id="openProfileModalBtn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" aria-label="View Profile icon" class="bi bi-person me-2" viewBox="0 0 16 16">
                      <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
                      <path fill-rule="evenodd" d="M8 9a5 5 0 0 0-5 5v.5a.5.5 0 0 0 .5.5h9a.5.5 0 0 0 .5-.5V14a5 5 0 0 0-5-5z"/>
                    </svg>
                    View Profile
                  </div>
                  </li>


                  <li><a class="dropdown-item d-flex align-items-center py-2" href="{{ url_for('messages') }}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" aria-label="Inbox icon" class="bi bi-envelope me-2" viewBox="0 0 16 16">
                      <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v.217l-8 4.8-8-4.8V4zm0 2.383l6.673 4.002a.5.5 0 0 0 .654 0L16 6.383V12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6.383z"/>
                    </svg>
                    Inbox
                    {% if global_data.unread_message |length > 0 %}
                        <span class="badge bg-danger position-absolute top-1 start-80 translate-middle p-1 pt-1 ">
                            {{ global_data.unread_message |length }}
                        </span>
                    {% endif %}
                  </a>
                  </li>

                  <li class="dropdown-divider"></li>

                  <li><a class="dropdown-item d-flex align-items-center  py-2 viewNotificationsBtn" aria-label="Notification bell icon" href="javascript: void(0);">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bell me-2" viewBox="0 0 16 16">
                        <path d="M8 16a2 2 0 0 0 1.985-1.75H6.015A2 2 0 0 0 8 16zm6.918-5c-.56-.77-1.02-1.616-1.263-2.609-.245-.993-.285-2.232-.285-3.691 0-1.292-.59-2.5-1.695-3.356C10.57.97 9.38.5 8 .5c-1.38 0-2.57.47-3.675 1.344C3.59 2.2 3 3.407 3 4.7c0 1.46-.04 2.698-.285 3.691-.243.993-.703 1.838-1.263 2.609a1.007 1.007 0 0 0 .861 1.601h11.007a1.007 1.007 0 0 0 .861-1.601zM8 1.5c1.036 0 2.05.348 2.857.964.806.615 1.343 1.499 1.343 2.236 0 1.473.043 2.797.293 3.82.25 1.023.68 1.778 1.132 2.372H4.375c.452-.594.883-1.349 1.132-2.372.25-1.023.293-2.347.293-3.82 0-.737.537-1.621 1.343-2.236C5.95 1.848 6.964 1.5 8 1.5z"/>
                    </svg>
                    Notification
                    {% if global_data.unread_notifications %}
                        <span class="badge bg-secondary position-absolute top-1 start-80 translate-middle p-1 pt-1 ">
                            {{ global_data.unread_notifications | length }}
                        </span>
                    {% endif %}
                  </a></li>

                  <li class="dropdown-divider"></li>

                  <li><a class="dropdown-item d-flex align-items-center py-2" href="{{ url_for('logout') }}" aria-label="Logout">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-right me-2" viewBox="0 0 16 16">
                      <path fill-rule="evenodd" d="M10.146 7.646a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708-.708L12.293 11H1.5a.5.5 0 0 1 0-1h10.793L10.146 8.354a.5.5 0 0 1 0-.708z"/>
                      <path fill-rule="evenodd" d="M15 3.5A1.5 1.5 0 0 1 13.5 5h-10a.5.5 0 0 1 0-1h10A1.5 1.5 0 0 1 15 3.5v9A1.5 1.5 0 0 1 13.5 14h-10a.5.5 0 0 1 0-1h10A1.5 1.5 0 0 1 15 12.5v-9z"/>
                    </svg>
                    Logout
                  </a></li>
                </ul>


              </li>
              <!-- User Icon End -->
            </ul>
          </div>
          {% endif %}

        </div>
      </nav>


      <!-- Main Section -->
      <div class="container main-section mt-1">

        <!-- Second header  -->
        <div class="card second-header shadow-sm rounded" style="width: 100%;">
          <div class="d-flex justify-content-between align-items-center">

            <!-- Date and Time aligned to the left -->
            <div class="px-3">
              <span id="currentDateTime" class="text-muted">{{ global_data.time }}</span>
            </div>

            <!-- Label Title Div (Centered) -->
            <div class="px-3 text-center flex-grow-1">
              {% block center_aligned_icons %}{% endblock %}
            </div>

            <!-- Container for Dark/Light Mode Switcher and Dropdown aligned to the right -->
            <div class="d-flex align-items-center ms-auto">
              <!-- Add User to task Button (Plus Icon) -->

                <div class="dropdown">
                    <button class="btn btn-outline-info btn-sm border-0 p-0 d-flex justify-content-center align-items-center dropdown-toggle"
                            type="button" id="dropdownMenuButton"
                            data-bs-toggle="dropdown"
                            aria-expanded="false"
                            aria-label="Add User"
                            style="width: 32px; height: 32px;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus" viewBox="0 0 16 16">
                            <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"/>
                        </svg>
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton" style="z-index: 9999 !important; position: absolute;">
                        <li><a class="dropdown-item" aria-label="Add friend" id="openModalBtn" href="javascript:void(0)">Add Friend</a></li>
                        <li><a class="dropdown-item" aria-label="Invite friend" id="openSendInviteModalBtn" href="javascript:void(0)">Invite Friend</a></li>

                    </ul>
                </div>

                <div class="col-auto px-2">
                    <a href="{{ url_for('friends_list') }}">
                    <button class="btn btn-outline-info btn-sm border-0 p-0 d-flex justify-content-center align-items-center active" type="button" aria-label="Add User" style="width: 32px; height: 32px;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-people" viewBox="0 0 16 16">
                            <path d="M13 7a3 3 0 1 0-6 0 3 3 0 0 0 6 0zM6 7a3 3 0 1 0-6 0 3 3 0 0 0 6 0z"/>
                            <path d="M0 13a6 6 0 0 1 12 0v1H0v-1zM8 13a5.984 5.984 0 0 0-2-.344c.6-.337 1.086-.775 1.404-1.202a4.5 4.5 0 0 0 1.592-.092 6 6 0 0 1 2-.344c1.1 0 2.132.292 3.004.8A5.978 5.978 0 0 0 8 13zm-4.002-.8a5.978 5.978 0 0 0-3.004-.8 6 6 0 0 1 2 .344c.6.337 1.086.775 1.404 1.202a4.5 4.5 0 0 0 1.592.092A5.978 5.978 0 0 0 3.998 12.2z"/>
                        </svg>
                    </button>
                    </a>
                </div>


              {% block left_aligned_icons %}{% endblock %}
            </div>

          </div>
        </div>
        <!-- Second header End -->

        <div class="main-content py-5">
          <div class="flash-message">
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }} custom-flash">{{ message }}</div>
                    {% endfor %}
                {% endif %}
            {% endwith %}
          </div>
          {% block content %} {% endblock %}
        </div>

      </div>

    </div>
  </div>
  {% endif %}

  <!-- Profile Modal -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <span class="close" id="closeProfileModalBtn" data-bs-dismiss="modal" aria-label="Close">&times;</span>
            <h2>{{ global_data.user.first_name | title }} Profile</h2>
            <form id="profileForm">
                <!-- Profile Picture -->
                <div class="form-group profile-picture">
                    <label for="profilePic"></label>
                    {% if global_data.user.profile_picture_path == '' %}
                    <img src="../{{ global_data.user.profile_picture_path }}" alt="Profile Picture" id="profilePicPreview" class="profile-pic-preview">
                    {% else %}
                    <span class="avatar-title rounded-circle border border-white bg-info text-white"
                      style="display: flex; align-items: center; justify-content: center; font-size: 0.9em; font-weight: bold; line-height: 1; width: 30px; height: 30px; overflow: hidden; text-align: center;">
                      {{ global_data.user.first_name[0].upper() }}{{ global_data.user.last_name[0].upper() }}
                    </span>
                    {% endif %}
                    <input type="file" id="profilePic" name="profilePic" style="display: none;">
                    <button type="button"  id="changePicBtn" class="btn button" disabled>Change Picture</button>
                </div>

                <div class="form-group">
                    <label for="name">Name</label>
                    <input type="text"
                           id="name"
                           name="name"
                           value="{{ global_data.user.first_name | title }} {{ global_data.user.last_name | title }}" disabled>
                </div>

                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" name="username" value="{{ global_data.user.username }}" disabled>
                </div>

                <div class="form-group">
                    <label for="nickname">Nickname</label>
                    <input type="text" id="nickname" name="nickname" value="{{ global_data.user.nickname }}" disabled>
                </div>

                <div class="form-group">
                    <label for="birthday">Birthday</label>
                    <input type="text"
                           id="birthday"
                           name="birthday"
                           value="{{ global_data.user.date_ }}" disabled>
                </div>

                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" name="email" value="{{ global_data.user.email }}" disabled>
                </div>

                <div class="form-group">
                    <label for="phone">Phone</label>
                    <input type="tel" id="phone" name="phone" value="{{ global_data.user.phone }}" disabled>
                </div>

                <div class="form-group">
                    <label for="address">Address</label>
                    <input type="text" id="address" name="address" value="{{ global_data.user.address }}" disabled>
                </div>

                <div class="form-group">
                    <label for="bio">Bio</label>
                    <textarea id="bio" name="bio" rows="4" disabled>{{ global_data.user.bio }}</textarea>
                </div>

                <div>
                    <button type="button" id="profileEditBtn" class="btn button form-group">Edit</button>
                    <button type="button" id="profileSaveBtn" class="btn button form-group" style="display: none;">Save</button>
                </div>
            </form>
        </div>
    </div>

  <!-- Notifications Modal -->
    <div id="notificationsModal" class="modal">
        <div class="modal-content">
            <span id="closeNotificationsBtn" class="close">&times;</span>
            <h2>Notifications</h2>
            <ul id="notificationList">
                {% for notification in global_data.notifications %}
                {% if notification.read %}
                {% if notification.category == 'project' %}
                <li>
                    <a class="notified" data-id="{{ notification.id }}" href="{{ url_for('project_select', number= notification.category_id) }}" style="text-decoration: none">
                        {{ notification.message | title }}
                    </a>
                </li>
                {% elif notification.category == 'todo' %}
                <li>
                    <a class="notified" data-id="{{ notification.id }}" href="{{ url_for('todo_list') }}" style="text-decoration: none">
                        {{ notification.message | title }}
                    </a>
                </li>
                {% elif notification.category == 'birthday' %}
                <li>
                    <a class="notified" data-id="{{ notification.id }}" href="{{ url_for('birthday_list') }}" style="text-decoration: none">
                        {{ notification.message | title }}
                    </a>
                </li>
                {% else %}
                <li>
                    <a class="notified" data-id="{{ notification.id }}" href="#" style="text-decoration: none">
                        {{ notification.message | title }}
                    </a>
                </li>
                {% endif %}
                {% else %}
                {% if notification.category == 'project' %}
                <li style="font-weight: bold;">
                    <a class="notified" data-id="{{ notification.id }}" href="{{ url_for('project_select', number= notification.category_id) }}" style="text-decoration: none">
                        {{ notification.message | title }}
                    </a>
                </li>
                {% elif notification.category == 'todo' %}
                <li style="font-weight: bold;">
                    <a class="notified" data-id="{{ notification.id }}" href="{{ url_for('todo_list') }}" style="text-decoration: none">
                        {{ notification.message | title }}
                    </a>
                </li>
                {% elif notification.category == 'birthday' %}
                <li style="font-weight: bold;">
                    <a class="notified" data-id="{{ notification.id }}" href="{{ url_for('birthday_list') }}" style="text-decoration: none">
                        {{ notification.message | title }}
                    </a>
                </li>
                {% else %}
                <li>
                    <a class="notified" data-id="{{ notification.id }}" href="#" style="text-decoration: none">
                        {{ notification.message | title }}
                    </a>
                </li>
                {% endif %}
                {% endif %}
                {% endfor %}
                <!-- Notifications will be injected here via JavaScript -->
            </ul>
        </div>
    </div>


    <div id="searchModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span id="closeSearchModalBtn" class="close">&times;</span>
            <h2 id="modalTitle"></h2>
            <ul id="searchList">
                <!-- Search results will be injected here via JavaScript -->
            </ul>
        </div>
    </div>



  <!-- Password Modal -->
    <div id="passwordModal" class="modal">
        <div class="modal-content">
            <h2>Confirm Password</h2>
            <form id="passwordConfirmForm">
                <div class="form-group">
                    <label for="password">Enter Password:</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <div class="form-actions">
                    <button type="button" id="cancelPasswordBtn" class="btn cancel">Cancel</button>
                    <button type="submit" class="btn confirm">Confirm</button>
                </div>
            </form>
        </div>
    </div>





  <div id="addUserModal" class="modal">
    <div class="modal-content">
        <span id="closeAddUserModalBtn" class="close">&times;</span>
        <h2>Send Friend Request</h2>
        <form action="{{ url_for('add_user') }}" method="post" id="addUserModalForm">
            <input type="hidden" name="form_id" value="form1">
            <div class="form-group">
                <label for="friend_username">Enter Friend Username:</label>
                <input type="text" id="friend_username" name="friend_username" required>
            </div>
            <div id="loadingIndicator" style="display: none;">Loading...</div>

            <div class="form-actions">
                <button type="button" id="searchUserBtn" class="btn">Search User</button>
                <button type="button" id="emailInviteBtn" class="btn" hidden>User not found. Send email invite link</button>
            </div>
            <div class="form-actions pt-3">
                <button type="button" id="cancelAddUserBtn" class="btn cancel">Cancel</button>
                <button type="submit" id="confirmUserModalBtn" class="btn confirm" disabled>Confirm</button>
            </div>
        </form>
    </div>
</div>



<!-- Send Invite Modal-->
  <div id="sendInviteModal" class="modal" >
    <div class="modal-content">
        <span id="closeSendInviteModalBtn" class="close">&times;</span>
        <h2>Send Friend Invite</h2>
        <form action="{{ url_for('add_user') }}" method="post" id="sendInviteModalForm">
            <input type="hidden" name="form_id" value="form2">
            <div class="form-group">

                <label for="friend_email" id="email_label" >
                    Enter email to send registration link:
                </label>
                <input type="email" id="friend_email" name="friend_email" required>
            </div>
            <div class="form-actions">
                <button type="button" id="cancelSendInviteBtn" class="btn cancel">Cancel</button>
                <button type="submit" class="btn confirm">Confirm</button>
            </div>
        </form>
    </div>
  </div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Profile Modal Script -->

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const profileModal = document.getElementById("profileModal");
        const openProfileModalBtn = document.getElementById("openProfileModalBtn");
        const closeProfileModalBtn = document.getElementById("closeProfileModalBtn");
        const editBtn = document.getElementById("profileEditBtn");
        const saveBtn = document.getElementById("profileSaveBtn");
        const changePicBtn = document.getElementById("changePicBtn");
        const profilePicInput = document.getElementById("profilePic");
        const inputs = Array.from(profileModal.querySelectorAll("input, textarea"));
        const birthdayLabel = document.querySelector("label[for='birthday']");
        const modalHeader = profileModal.querySelector("h2");
        const passwordModal = document.getElementById("passwordModal");
        const cancelPasswordBtn = document.getElementById("cancelPasswordBtn");
        const passwordForm = document.getElementById("passwordConfirmForm");
        const username = "{{ global_data.user.username }}"; // Username for password check
        const userId = {{ global_data.user.id }}; // User ID for update

        const setViewState = () => {
            modalHeader.textContent = "{{ global_data.user.first_name | title }} Profile";
            changePicBtn.disabled = true;
            saveBtn.style.display = "none";
            editBtn.style.display = "inline-block";
            birthdayLabel.textContent = "Birthday";

            inputs.forEach(input => {
                input.disabled = true;
            });
        };

        const setEditState = () => {
            modalHeader.textContent = "Edit Profile";
            changePicBtn.disabled = false;
            saveBtn.style.display = "inline-block";
            editBtn.style.display = "none";
            birthdayLabel.textContent = "Birthday (format: dd-mm-yy)";

            inputs.forEach(input => {
                if (input.id !== "name" && input.id !== "username" && input.id !== "email") {
                    input.disabled = false;
                }
            });
        };

        const showPasswordModal = () => {
            passwordModal.style.display = "block"; // Show the password modal
        };

        const hidePasswordModal = () => {
            passwordModal.style.display = "none"; // Hide the password modal
        };

        const saveUserData = () => {
            const formData = new FormData();
            formData.append('nickname', document.getElementById('nickname').value);
            formData.append('birthday', document.getElementById('birthday').value);
            formData.append('phone', document.getElementById('phone').value);
            formData.append('address', document.getElementById('address').value);
            formData.append('bio', document.getElementById('bio').value);

            fetch(`/update_user_info/${userId}`, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert("Profile updated successfully!");
                    setViewState();
                } else {
                    alert("Failed to update profile. Please try again.");
                }
            })
            .catch(error => {
                console.error("Error updating user data:", error);
                alert("An error occurred. Please try again later.");
            });
        };

        // Event listeners
        saveBtn.addEventListener("click", () => {
            showPasswordModal();
        });

        cancelPasswordBtn.addEventListener("click", () => {
            hidePasswordModal();
        });

        passwordForm.addEventListener("submit", (e) => {
            e.preventDefault();

            const password = passwordForm.password.value;

            // Validate password via API
            fetch(`/check_password/${username}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ password })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    saveUserData(); // Save updated profile data
                    hidePasswordModal(); // Close the modal
                } else {
                    alert("Incorrect password. Please try again.");
                }
            })
            .catch(error => {
                console.error("Error validating password:", error);
                alert("An error occurred. Please try again later.");
            });
        });

        openProfileModalBtn.onclick = () => {
            profileModal.style.display = "block";
        };

        closeProfileModalBtn.onclick = () => {
            profileModal.style.display = "none";
        };

        window.onclick = (event) => {
            if (event.target === profileModal) {
                profileModal.style.display = "none";
            }
            if (event.target === passwordModal) {
                hidePasswordModal();
            }
        };

        editBtn.addEventListener("click", () => {
            setEditState();
        });

        setViewState();
    });
</script>





<!--  <script>-->
<!--    // Notifications Modal Script-->
<!--    const notificationsModal = document.getElementById("notificationsModal");-->
<!--    const viewNotificationsBtn = document.getElementById("viewNotificationsBtn");-->
<!--    const closeNotificationsBtn = document.getElementById("closeNotificationsBtn");-->
<!--    const notificationList = document.getElementById("notificationList");-->


<!--    // Open notifications modal and populate notification list-->
<!--    viewNotificationsBtn.onclick = function() {-->
<!--        notificationsModal.style.display = "block";-->

<!--    };-->

<!--    // Close notifications modal-->
<!--    closeNotificationsBtn.onclick = function() {-->
<!--        notificationsModal.style.display = "none";-->
<!--    };-->

<!--    // Close notifications modal when clicking outside it-->
<!--    window.onclick = function(event) {-->
<!--        if (event.target === notificationsModal) {-->
<!--            notificationsModal.style.display = "none";-->
<!--        }-->
<!--    };-->
<!--</script>-->


  <script>
    // Notifications Modal Script
    const notificationsModal = document.getElementById("notificationsModal");
    const viewNotificationsBtns = document.querySelectorAll(".viewNotificationsBtn");
    const closeNotificationsBtn = document.getElementById("closeNotificationsBtn");

    // Open notifications modal when any button with the "viewNotificationsBtn" class is clicked
    viewNotificationsBtns.forEach(btn => {
        btn.onclick = function () {
            notificationsModal.style.display = "block";
        };
    });

    // Close notifications modal
    closeNotificationsBtn.onclick = function () {
        notificationsModal.style.display = "none";
    };

    // Close notifications modal when clicking outside it
    window.onclick = function (event) {
        if (event.target === notificationsModal) {
            notificationsModal.style.display = "none";
        }
    };
</script>




<script>
    document.addEventListener('DOMContentLoaded', () => {
    // Modal elements
    const searchModal = document.getElementById('searchModal');
    const modalTitle = document.getElementById('modalTitle');
    const searchList = document.getElementById('searchList');
    const closeSearchModalBtn = document.getElementById('closeSearchModalBtn');

    // Input field for search term
    const searchInput = document.getElementById('searchBarInput');


    // Add event listeners to dropdown items
    document.querySelectorAll('.search.dropdown-item').forEach(item => {
        item.addEventListener('click', function (event) {
            event.preventDefault(); // Prevent default link behavior

            const topic = this.getAttribute('data-topic'); // Get the topic
            const searchTerm = searchInput.value.trim(); // Get the search term

            if (!searchTerm) {
                alert('Please enter a search term.');
                return;
            }

            // Fetch results from the backend
            fetch(`/search/${topic}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ query: searchTerm }),
            })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert(data.error);
                        return;
                    }

                    // Populate the modal
                    const titleCaseTopic = topic.replace(/\w\S*/g, (word) => {
                        return word.charAt(0).toUpperCase() + word.slice(1).toLowerCase();
                    });
                    modalTitle.textContent = `Search Results for "${searchTerm}" in "${titleCaseTopic}"`;
                    searchList.innerHTML = ''; // Clear existing results

                    if (data.results.length === 0) {
                        const noResults = document.createElement('li');
                        noResults.textContent = 'No results found.';
                        searchList.appendChild(noResults);
                    } else {
                        data.results.forEach(result => {
                            const listItem = document.createElement('li');
                            const link = document.createElement('a');

                            // Determine the URL based on the topic
                            if (topic === 'events') {
                                link.href = `/project/${result.id}`;
                            } else if (topic === 'tasks') {
                                link.href = '/todo';
                            } else if (topic === 'birthdays') {
                                link.href = '/birthdays';
                            }

                            link.textContent =
                                result.title || result.task_name || `${result.first_name} ${result.last_name}`;
                            link.style.textDecoration = 'none'; // Optional styling
                            link.style.color = 'inherit'; // Match the list item's text color

                            listItem.appendChild(link);
                            searchList.appendChild(listItem);
                        });
                    }

                    // Show the modal
                    searchModal.style.display = 'block';
                })
                .catch(error => {
                    console.error('Error fetching search results:', error);
                    alert('An error occurred while fetching search results.');
                });
        });
    });

    // Close modal on clicking the close button
    closeSearchModalBtn.addEventListener('click', () => {
        searchModal.style.display = 'none';
    });

    // Close modal when clicking outside of it
    window.addEventListener('click', event => {
        if (event.target === searchModal) {
            searchModal.style.display = 'none';
        }
    });
});

</script>





  <script>
    // Function to mark a notification as read
    function markNotificationAsRead(notificationId) {
        fetch(`/update_notification/${notificationId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                console.log(`Notification ${notificationId} marked as read.`);
            } else {
                console.error(`Failed to mark notification as read: ${data.error}`);
            }
        })
        .catch(error => console.error('Error:', error));
    }

    // Add onclick event to all elements with the class "notified"
    document.addEventListener('DOMContentLoaded', () => {
        const notifiedElements = document.querySelectorAll('.notified');

        notifiedElements.forEach(element => {
            element.addEventListener('click', function (event) {
                const notificationId = this.getAttribute('data-id');
                if (notificationId) {
                    // Mark the notification as read asynchronously
                    markNotificationAsRead(notificationId);
                }

                // Do not prevent default behavior to allow navigation
            });
        });
    });
</script>



<script>
    document.addEventListener("DOMContentLoaded", function () {
        const modal = document.getElementById("addUserModal");
        const openModalBtn = document.getElementById("openModalBtn");
        const searchUserBtn = document.getElementById("searchUserBtn");
        const emailInviteBtn = document.getElementById("emailInviteBtn");
        const cancelBtn = document.getElementById("cancelAddUserBtn");
        const closeBtn = document.getElementById("closeAddUserModalBtn");
        const confirmBtn = document.getElementById("confirmUserModalBtn");
        const friendUsernameInput = document.getElementById("friend_username");
        const addUserModalForm = document.getElementById("addUserModalForm");
        const loadingIndicator = document.getElementById("loadingIndicator");
        const inviteModal = document.getElementById("sendInviteModal");
        const closeInviteModalBtn = document.getElementById("closeInviteModalBtn");

        // Function to show the main modal
        function openModal() {
            modal.style.display = "block";
            resetForm();
        }

        // Function to close the main modal
        function closeModal() {
            modal.style.display = "none";
            resetForm();
        }

        // Function to show the invite modal
        function openInviteModal() {
            modal.style.display = "none"; // Hide the main modal
            inviteModal.style.display = "block"; // Show the invite modal
        }

        // Function to close the invite modal
        function closeInviteModal() {
            inviteModal.style.display = "none"; // Hide the invite modal
        }

        // Function to reset the form and button states
        function resetForm() {
            friendUsernameInput.disabled = false;
            friendUsernameInput.value = "";
            confirmBtn.disabled = true; // Initially disable confirm button
            emailInviteBtn.hidden = true; // Hide email invite button
            loadingIndicator.style.display = "none"; // Hide loading indicator when modal is reset
        }

        // Event listener for opening the main modal
        openModalBtn.addEventListener("click", openModal);

        // Event listeners for closing the main modal
        cancelBtn.addEventListener("click", closeModal);
        closeBtn.addEventListener("click", closeModal);

        // Event listener for searching user
        searchUserBtn.addEventListener("click", async function (event) {
            event.preventDefault();
            const username = friendUsernameInput.value.trim();

            if (!username) {
                alert("Please enter a username.");
                return;
            }

            // Show loading indicator while searching
            loadingIndicator.style.display = "block";

            try {
                const response = await fetch(`/fetch-user/${username}`, {
                    method: "GET",
                    headers: {
                        "Content-Type": "application/json",
                    },
                });

                if (response.ok) {
                    const data = await response.json();

                    // Enable the confirm button if the user is found
                    confirmBtn.removeAttribute("disabled");
                    emailInviteBtn.hidden = true; // Hide email invite button if user is found
                } else {
                    // Show email invite button if user is not found
                    friendUsernameInput.disabled = true;
                    emailInviteBtn.hidden = false;
                    confirmBtn.disabled = true; // Ensure confirm button remains disabled
                }
            } catch (error) {
                console.error("Error fetching user:", error.message);
                alert("An error occurred. Please try again later.");
            } finally {
                // Hide loading indicator after request is completed
                loadingIndicator.style.display = "none";
            }
        });

        // Event listener for opening the invite modal via email invite button
        emailInviteBtn.addEventListener("click", openInviteModal);

        // Event listener for closing the invite modal


        // Close modal if user clicks outside of it
        window.addEventListener("click", function (event) {
            if (event.target === modal) {
                closeModal();
            }
            if (event.target === inviteModal) {
                closeInviteModal();
            }
        });

        // Prevent form submission if confirm button is disabled
        addUserModalForm.addEventListener("submit", function (event) {
            if (confirmBtn.disabled) {
                event.preventDefault(); // Prevent form submission if confirm button is disabled
                alert("Please search for a valid user or send an email invite.");
            }
        });
    });
</script>


<script>
    document.addEventListener("DOMContentLoaded", function () {
        const modal = document.getElementById("sendInviteModal");
        const openModalBtn = document.getElementById("openSendInviteModalBtn");
        const cancelBtn = document.getElementById("cancelSendInviteBtn");
        const closeBtn = document.getElementById("closeSendInviteModalBtn");

        function openModal() {
            modal.style.display = "block";
        }

        function closeModal() {
            modal.style.display = "none";
        }

        // Event listener
        openModalBtn.addEventListener("click", openModal);
        cancelBtn.addEventListener("click", closeModal);
        closeBtn.addEventListener("click", closeModal);

        window.addEventListener("click", function (event) {
            if (event.target === modal) {
                closeModal();
            }
        });

    });
</script>


<script>
    document.addEventListener("DOMContentLoaded", () => {
    const profilePicInput = document.getElementById("profilePic");
    const changePicBtn = document.getElementById("changePicBtn");
    const profilePicPreview = document.getElementById("profilePicPreview");
    const userId = {{ global_data.user.id }}; // Dynamically pass user ID from Flask

    // Open file dialog when "Change Picture" button is clicked
    changePicBtn.addEventListener("click", () => {
        if (!changePicBtn.disabled) {
            profilePicInput.click();
        }
    });

    // Handle file selection and upload
    profilePicInput.addEventListener("change", async () => {
        if (profilePicInput.files.length === 0) {
            alert("No file selected.");
            return;
        }

        const file = profilePicInput.files[0];
        const formData = new FormData();
        formData.append("file", file);

        try {
            const response = await fetch(`/upload-profile-picture/${userId}`, {
                method: "POST",
                body: formData,
            });

            const data = await response.json();
            if (response.ok) {
                alert("Profile picture updated successfully!");

                // Update the image preview with the new picture
                const newImageUrl = data.file_path.startsWith("http")
                    ? data.file_path
                    : `/${data.file_path}`;
                profilePicPreview.src = newImageUrl;
            } else {
                alert(`Error: ${data.error}`);
            }
        } catch (error) {
            console.error("Error uploading profile picture:", error);
            alert("An error occurred while uploading the profile picture.");
        }
    });
});

</script>




{% block script %}

{% endblock %}



</body>
<!-- Footer -->
<footer class="footer">

    <p>PrOrganize &copy; {{global_data.time.split(',')[1]}}</p>
</footer>
</html>
