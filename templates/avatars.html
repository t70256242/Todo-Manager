{% extends 'base.html' %}


{% block styles %}

  <style>
    .ch-chart-data-container {
        padding: 20px;
    }
    .the-project-header-nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }
    .chart-container {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        justify-content: center;
    }
    .chart-item {
        flex: 1 1 300px;
        display: flex;
        flex-direction: column; /* Ensure header and chart are stacked vertically */
        justify-content: center;
        align-items: center;
    }
    .chart-item canvas {
        width: 60%;
        max-width: 160px; /* Adjust the max-width to resize the chart */
        height: auto; /* Maintain the aspect ratio */
    }

</style>

{% endblock %}

{% block center_aligned_icons %}
  <span class="label-title">Charts</span>
{% endblock %}


{% block left_aligned_icons %}
  <!-- Add User to task Button (Plus Icon) -->
  <div class="col-auto px-2">
    <button class="btn btn-outline-info btn-sm border-0 p-0 d-flex justify-content-center align-items-center" type="button" aria-label="Add User" style="width: 32px; height: 32px;">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus" viewBox="0 0 16 16">
        <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"/>
      </svg>
    </button>
  </div>


  <!-- Visibility Dropdown -->
  <div class="px-2">
    <button class="btn btn-outline-secondary btn-sm border-0 p-0 d-flex justify-content-center align-items-center" type="button" id="workspaceVisibilityDropdown" data-bs-toggle="dropdown" aria-expanded="false" style="width: 32px; height: 32px;">
      <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-airplane" viewBox="0 0 16 16">
        <path d="M6.428 1.151C6.708.591 7.213 0 8 0s1.292.592 1.572 1.151C9.861 1.73 10 2.431 10 3v3.691l5.17 2.585a1.5 1.5 0 0 1 .83 1.342V12a.5.5 0 0 1-.582.493l-5.507-.918-.375 2.253 1.318 1.318A.5.5 0 0 1 10.5 16h-5a.5.5 0 0 1-.354-.854l1.319-1.318-.376-2.253-5.507.918A.5.5 0 0 1 0 12v-1.382a1.5 1.5 0 0 1 .83-1.342L6 6.691V3c0-.568.14-1.271.428-1.849m.894.448C7.111 2.02 7 2.569 7 3v4a.5.5 0 0 1-.276.447l-5.448 2.724a.5.5 0 0 0-.276.447v.792l5.418-.903a.5.5 0 0 1 .575.41l.5 3a.5.5 0 0 1-.14.437L6.708 15h2.586l-.647-.646a.5.5 0 0 1-.14-.436l.5-3a.5.5 0 0 1 .576-.411L15 11.41v-.792a.5.5 0 0 0-.276-.447L9.276 7.447A.5.5 0 0 1 9 7V3c0-.432-.11-.979-.322-1.401C8.458 1.159 8.213 1 8 1s-.458.158-.678.599"/>
      </svg>
    </button>

    <ul class="dropdown-menu" aria-labelledby="workspaceVisibilityDropdown">
      <li><a class="dropdown-item" href="#">Private</a></li>
      <li><a class="dropdown-item" href="#">Workspace visible</a></li>
      <li><a class="dropdown-item" href="#">Public</a></li>
      <li><hr class="dropdown-divider"></li>
      <li><a class="dropdown-item" href="#">Manage visibility settings</a></li>
    </ul>
  </div>


  <!-- Power-Ups Button (Bar Chart Icon) -->
  <div class="col-auto px-2">
  <button class="btn btn-outline-info btn-sm border-0 p-0 d-flex justify-content-center align-items-center active" type="button" aria-label="Power-Ups" style="width: 32px; height: 32px;">
    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-bar-chart" viewBox="0 0 16 16">
      <path d="M4 11H2v3h2zm5-4H7v7h2zm5-5v12h-2V2zm-2-1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zM6 7a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v7a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1zm-5 4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1z"/>
    </svg>
  </button>
  </div>

  <!-- More -->
  <div class="col-auto px-2">
  <button class="btn btn-outline-info btn-sm border-0 p-0 d-flex justify-content-center align-items-center" type="button" aria-label="Power-Ups" style="width: 32px; height: 32px;">
    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-bar-chart" viewBox="0 0 16 16">
      <path d="M4 11H2v3h2zm5-4H7v7h2zm5-5v12h-2V2zm-2-1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zM6 7a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v7a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1zm-5 4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1z"/>
    </svg>
  </button>
  </div>

  <!-- More -->
  <div class="col-auto px-2">
  <button class="btn btn-outline-info btn-sm border-0 p-0 d-flex justify-content-center align-items-center" type="button" aria-label="Power-Ups" style="width: 32px; height: 32px;">
    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-bar-chart" viewBox="0 0 16 16">
      <path d="M4 11H2v3h2zm5-4H7v7h2zm5-5v12h-2V2zm-2-1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zM6 7a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v7a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1zm-5 4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1z"/>
    </svg>
  </button>
  </div>
{% endblock %}




{% block content %}
<!--    <div class="ch-chart-data-container">-->
<!--  &lt;!&ndash; Header with navigation buttons &ndash;&gt;-->
<!--  <div class="the-project-header-nav">-->
<!--    <button class="btn btn-outline-secondary rounded" onclick="previousData()">← Previous</button>-->
<!--    <h5 id="data-title">Data Item 1</h5>-->
<!--    <button class="btn btn-outline-secondary rounded" onclick="nextData()">Next →</button>-->
<!--  </div>-->

<!--  <div class="chart-container">-->
<!--    <div class="chart-item">-->
<!--      <canvas id="barChart"></canvas>-->
<!--    </div>-->
<!--    <div class="chart-item">-->
<!--      <canvas id="pieChart"></canvas>-->
<!--    </div>-->
<!--    <div class="chart-item">-->
<!--      <canvas id="horizontalBarChart"></canvas>-->
<!--    </div>-->
<!--    <div class="chart-item">-->
<!--      <canvas id="scatterPlot"></canvas>-->
<!--    </div>-->
<!--  </div>-->
<!--</div>-->


<div class="ch-chart-data-container">


  <div class="chart-container">
    <div class="chart-item">
      <h5>Project Timeline</h5>
      <canvas id="ganttChart"></canvas>
    </div>
    <div class="chart-item">
      <h5>Task Distribution</h5>
      <canvas id="donutChart"></canvas>
    </div>
    <div class="chart-item">
      <h5>Task Status Trend</h5>
      <canvas id="lineChart"></canvas>
    </div>
    <div class="chart-item">
      <h5>Resource Allocation</h5>
      <canvas id="stackedBarChart"></canvas>
    </div>
  </div>
</div>


{% endblock %}


{% block script %}

<!--<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>-->
<!--<script>-->
<!--  const dataList = [-->
<!--    { title: "Data Item 1", values: [12, 19, 3, 5, 2, 3] },-->
<!--    { title: "Data Item 2", values: [7, 11, 5, 8, 3, 7] },-->
<!--    { title: "Data Item 3", values: [15, 10, 9, 6, 11, 4] },-->
<!--  ];-->

<!--  let currentIndex = 0;-->

<!--  const barCtx = document.getElementById('barChart').getContext('2d');-->
<!--  const pieCtx = document.getElementById('pieChart').getContext('2d');-->
<!--  const horizontalBarCtx = document.getElementById('horizontalBarChart').getContext('2d');-->
<!--  const scatterCtx = document.getElementById('scatterPlot').getContext('2d');-->

<!--  let barChart = new Chart(barCtx, {-->
<!--    type: 'bar',-->
<!--    data: {-->
<!--      labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],-->
<!--      datasets: [{-->
<!--        label: 'Values',-->
<!--        data: dataList[currentIndex].values,-->
<!--        backgroundColor: 'rgba(75, 192, 192, 0.2)',-->
<!--        borderColor: 'rgba(75, 192, 192, 1)',-->
<!--        borderWidth: 1-->
<!--      }]-->
<!--    },-->
<!--    options: {-->
<!--      scales: { y: { beginAtZero: true } }-->
<!--    }-->
<!--  });-->

<!--  let pieChart = new Chart(pieCtx, {-->
<!--    type: 'pie',-->
<!--    data: {-->
<!--      labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],-->
<!--      datasets: [{-->
<!--        data: dataList[currentIndex].values,-->
<!--        backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40']-->
<!--      }]-->
<!--    }-->
<!--  });-->

<!--  let horizontalBarChart = new Chart(horizontalBarCtx, {-->
<!--    type: 'bar',-->
<!--    data: {-->
<!--      labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],-->
<!--      datasets: [{-->
<!--        label: 'Values',-->
<!--        data: dataList[currentIndex].values,-->
<!--        backgroundColor: 'rgba(153, 102, 255, 0.2)',-->
<!--        borderColor: 'rgba(153, 102, 255, 1)',-->
<!--        borderWidth: 1-->
<!--      }]-->
<!--    },-->
<!--    options: {-->
<!--      indexAxis: 'y',-->
<!--      scales: { x: { beginAtZero: true } }-->
<!--    }-->
<!--  });-->

<!--  let scatterPlot = new Chart(scatterCtx, {-->
<!--    type: 'scatter',-->
<!--    data: {-->
<!--      datasets: [{-->
<!--        label: 'Data Points',-->
<!--        data: dataList[currentIndex].values.map((y, i) => ({ x: i + 1, y })),-->
<!--        backgroundColor: 'rgba(255, 99, 132, 1)'-->
<!--      }]-->
<!--    },-->
<!--    options: {-->
<!--      scales: { x: { type: 'linear', position: 'bottom', beginAtZero: true } }-->
<!--    }-->
<!--  });-->

<!--  function updateCharts() {-->
<!--    document.getElementById('data-title').innerText = dataList[currentIndex].title;-->

<!--    const values = dataList[currentIndex].values;-->
<!--    barChart.data.datasets[0].data = values;-->
<!--    pieChart.data.datasets[0].data = values;-->
<!--    horizontalBarChart.data.datasets[0].data = values;-->
<!--    scatterPlot.data.datasets[0].data = values.map((y, i) => ({ x: i + 1, y }));-->

<!--    barChart.update();-->
<!--    pieChart.update();-->
<!--    horizontalBarChart.update();-->
<!--    scatterPlot.update();-->
<!--  }-->

<!--  function previousData() {-->
<!--    currentIndex = (currentIndex > 0) ? currentIndex - 1 : dataList.length - 1;-->
<!--    updateCharts();-->
<!--  }-->

<!--  function nextData() {-->
<!--    currentIndex = (currentIndex < dataList.length - 1) ? currentIndex + 1 : 0;-->
<!--    updateCharts();-->
<!--  }-->
<!--</script>-->



<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  let currentIndex = 0;
  let dataList = [];

  // Fetch data from the backend
  async function fetchProjectProgress() {
    try {
      const response = await fetch('/project-progress');
      dataList = await response.json();
      initializeCharts();
    } catch (error) {
      console.error('Error fetching project progress:', error);
    }
  }

  // Chart contexts
  const ganttCtx = document.getElementById('ganttChart').getContext('2d');
  const donutCtx = document.getElementById('donutChart').getContext('2d');
  const lineCtx = document.getElementById('lineChart').getContext('2d');
  const stackedBarCtx = document.getElementById('stackedBarChart').getContext('2d');

  // Chart instances
  let ganttChart, donutChart, lineChart, stackedBarChart;

  // Initialize charts
  function initializeCharts() {
    document.getElementById('data-title').innerText = dataList[currentIndex].title;
    renderGanttChart();
    renderDonutChart();
    renderLineChart();
    renderStackedBarChart();
  }

  // Render Gantt Chart
  function renderGanttChart() {
    const ganttData = dataList[currentIndex].gantt || [];
    const labels = ganttData.map(task => task.label);
    const startDates = ganttData.map(task => new Date(task.start).getDate());
    const endDates = ganttData.map(task => new Date(task.end).getDate());

    ganttChart = new Chart(ganttCtx, {
      type: 'bar',
      data: {
        labels: labels.length > 0 ? labels : ['No Data'],
        datasets: labels.length > 0 ? [
          { label: 'Start', data: startDates, backgroundColor: 'rgba(75, 192, 192, 0.5)' },
          { label: 'End', data: endDates, backgroundColor: 'rgba(153, 102, 255, 0.5)' },
        ] : [],
      },
      options: { scales: { x: { stacked: true }, y: { beginAtZero: true } } },
    });
  }

  // Render Donut Chart
  function renderDonutChart() {
    const donutData = dataList[currentIndex].donut || { todo: 0, doing: 0, done: 0 };

    donutChart = new Chart(donutCtx, {
      type: 'doughnut',
      data: {
        labels: ['Todo', 'Doing', 'Done'],
        datasets: [
          {
            data: Object.values(donutData),
            backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56'],
          },
        ],
      },
    });
  }

  // Render Line Chart
  function renderLineChart() {
    const lineData = dataList[currentIndex].line || [];
    const labels = lineData.map(item => item.date);
    const todoData = lineData.map(item => item.todo);
    const doingData = lineData.map(item => item.doing);
    const doneData = lineData.map(item => item.done);

    lineChart = new Chart(lineCtx, {
      type: 'line',
      data: {
        labels: labels.length > 0 ? labels : ['No Data'],
        datasets: labels.length > 0 ? [
          { label: 'Todo', data: todoData, borderColor: 'rgba(255, 99, 132, 1)', fill: false },
          { label: 'Doing', data: doingData, borderColor: 'rgba(54, 162, 235, 1)', fill: false },
          { label: 'Done', data: doneData, borderColor: 'rgba(75, 192, 192, 1)', fill: false },
        ] : [],
      },
      options: { scales: { y: { beginAtZero: true } } },
    });
  }

  // Render Stacked Bar Chart
  function renderStackedBarChart() {
    const stackedData = dataList[currentIndex].stacked || [];
    const labels = stackedData.map(item => item.team_member);
    const todoData = stackedData.map(item => item.todo);
    const doingData = stackedData.map(item => item.doing);
    const doneData = stackedData.map(item => item.done);

    stackedBarChart = new Chart(stackedBarCtx, {
      type: 'bar',
      data: {
        labels: labels.length > 0 ? labels : ['No Data'],
        datasets: labels.length > 0 ? [
          { label: 'Todo', data: todoData, backgroundColor: 'rgba(255, 99, 132, 0.5)' },
          { label: 'Doing', data: doingData, backgroundColor: 'rgba(54, 162, 235, 0.5)' },
          { label: 'Done', data: doneData, backgroundColor: 'rgba(75, 192, 192, 0.5)' },
        ] : [],
      },
      options: { scales: { x: { stacked: true }, y: { stacked: true } } },
    });
  }

  // Update charts
  function updateCharts() {
    document.getElementById('data-title').innerText = dataList[currentIndex].title;

    ganttChart.destroy();
    donutChart.destroy();
    lineChart.destroy();
    stackedBarChart.destroy();

    renderGanttChart();
    renderDonutChart();
    renderLineChart();
    renderStackedBarChart();
  }

  // Navigation
  function previousData() {
    currentIndex = (currentIndex > 0) ? currentIndex - 1 : dataList.length - 1;
    updateCharts();
  }

  function nextData() {
    currentIndex = (currentIndex < dataList.length - 1) ? currentIndex + 1 : 0;
    updateCharts();
  }

  // Fetch data on page load
  fetchProjectProgress();
</script>





{% endblock %}